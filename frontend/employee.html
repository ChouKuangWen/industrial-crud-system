<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å“¡å·¥è³‡æ–™ CRUD ç³»çµ±</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="p-4">
  <div class="container">
    <h2 class="mb-4">å“¡å·¥è³‡æ–™ç®¡ç†ç³»çµ±</h2>

    <!-- ğŸš¦ CRUD æ“ä½œé¸å–® -->
    <div class="mb-4">
      <label class="form-label">è«‹é¸æ“‡æ“ä½œï¼š</label>
      <select id="crudSelect" class="form-select" onchange="switchMode()">
        <option value="">-- è«‹é¸æ“‡ --</option>
        <option value="create">C - æ–°å¢å“¡å·¥</option>
        <option value="read">R - æŸ¥è©¢å“¡å·¥</option>
        <option value="update">U - ä¿®æ”¹å“¡å·¥</option>
        <option value="delete">D - åˆªé™¤å“¡å·¥</option>
      </select>
    </div>

    <!-- âœ… Cï¼šæ–°å¢ -->
    <div id="createBox" class="crud-box" style="display:none">
      <h4>â• æ–°å¢å“¡å·¥</h4>
      <input id="c_factory_id" type="number" class="form-control mb-2" placeholder="æ‰€å±¬å·¥å»  ID">
      <input id="c_name" class="form-control mb-2" placeholder="å“¡å·¥å§“å">
      <input id="c_position" class="form-control mb-2" placeholder="è·ä½">
      <input id="c_phone" class="form-control mb-2" placeholder="è¯çµ¡é›»è©±">
      <input id="c_hire_date" type="date" class="form-control mb-2" placeholder="å…¥è·æ—¥æœŸ">
      <button class="btn btn-primary" onclick="createEmployee()">æ–°å¢</button>
    </div>

    <!-- ğŸ” Rï¼šæŸ¥è©¢ -->
    <div id="readBox" class="crud-box" style="display:none">
      <h4>ğŸ” æŸ¥è©¢å“¡å·¥</h4>
      <input id="r_keyword" class="form-control mb-2" placeholder="è¼¸å…¥å“¡å·¥å§“åé—œéµå­—">
      <button class="btn btn-secondary mb-2" onclick="readEmployees()">æŸ¥è©¢</button>
      <table class="table table-bordered">
        <thead><tr><th>ID</th><th>å§“å</th><th>å·¥å» ID</th><th>è·ä½</th><th>é›»è©±</th><th>å…¥è·æ—¥æœŸ</th></tr></thead>
        <tbody id="readTable"></tbody>
      </table>
    </div>

    <!-- ğŸ“ Uï¼šä¿®æ”¹ -->
    <div id="updateBox" class="crud-box" style="display:none">
      <h4>ğŸ“ ä¿®æ”¹å“¡å·¥</h4>
      <input id="u_id" type="number" class="form-control mb-2" placeholder="è¼¸å…¥æ¬²ä¿®æ”¹å“¡å·¥ ID">
      <button class="btn btn-warning mb-3" onclick="loadUpdateEmployee()">è¼‰å…¥è³‡æ–™</button>
      <div id="updateForm" style="display:none">
        <input id="u_factory_id" type="number" class="form-control mb-2" placeholder="æ‰€å±¬å·¥å»  ID">
        <input id="u_name" class="form-control mb-2" placeholder="å“¡å·¥å§“å">
        <input id="u_position" class="form-control mb-2" placeholder="è·ä½">
        <input id="u_phone" class="form-control mb-2" placeholder="è¯çµ¡é›»è©±">
        <input id="u_hire_date" type="date" class="form-control mb-2" placeholder="å…¥è·æ—¥æœŸ">
        <button class="btn btn-success" onclick="updateEmployee()">å„²å­˜ä¿®æ”¹</button>
      </div>
    </div>

    <!-- âŒ Dï¼šåˆªé™¤ -->
    <div id="deleteBox" class="crud-box" style="display:none">
      <h4>âŒ åˆªé™¤å“¡å·¥</h4>
      <input id="d_id" type="number" class="form-control mb-2" placeholder="è¼¸å…¥å“¡å·¥ ID">
      <button class="btn btn-danger" onclick="deleteEmployee()">åˆªé™¤</button>
    </div>
  </div>

  <script>
    const api = "http://localhost:8000/employees";

    function switchMode() {
      document.querySelectorAll(".crud-box").forEach(box => box.style.display = "none");
      const mode = document.getElementById("crudSelect").value;
      if (mode) document.getElementById(mode + "Box").style.display = "block";
    }

    async function createEmployee() {
      const employee = {
        factory_id: parseInt(document.getElementById("c_factory_id").value),
        name: document.getElementById("c_name").value,
        position: document.getElementById("c_position").value,
        phone: document.getElementById("c_phone").value,
        hire_date: document.getElementById("c_hire_date").value
      };
      try {
        await axios.post(api, employee);
        alert("âœ… æ–°å¢æˆåŠŸ");
      } catch (err) {
        alert("âŒ éŒ¯èª¤ï¼š" + (err.response?.data?.detail || err.message));
      }
    }

    async function readEmployees() {
      const keyword = document.getElementById("r_keyword").value.toLowerCase();
      const res = await axios.get(api);
      const table = document.getElementById("readTable");
      table.innerHTML = "";
      res.data.forEach(e => {
        if (e.name.toLowerCase().includes(keyword)) {
          table.innerHTML += `<tr>
            <td>${e.employee_id}</td><td>${e.name}</td>
            <td>${e.factory_id}</td><td>${e.position || ""}</td>
            <td>${e.phone || ""}</td><td>${e.hire_date || ""}</td>
          </tr>`;
        }
      });
    }

    async function loadUpdateEmployee() {
      const id = document.getElementById("u_id").value;
      try {
        const res = await axios.get(`${api}/${id}`);
        const e = res.data;
        document.getElementById("u_factory_id").value = e.factory_id;
        document.getElementById("u_name").value = e.name;
        document.getElementById("u_position").value = e.position;
        document.getElementById("u_phone").value = e.phone;
        document.getElementById("u_hire_date").value = e.hire_date || "";
        document.getElementById("updateForm").style.display = "block";
      } catch (err) {
        alert("âŒ æ‰¾ä¸åˆ°å“¡å·¥");
        document.getElementById("updateForm").style.display = "none";
      }
    }

    async function updateEmployee() {
      const id = document.getElementById("u_id").value;
      const employee = {
        factory_id: parseInt(document.getElementById("u_factory_id").value),
        name: document.getElementById("u_name").value,
        position: document.getElementById("u_position").value,
        phone: document.getElementById("u_phone").value,
        hire_date: document.getElementById("u_hire_date").value
      };
      try {
        await axios.put(`${api}/${id}`, employee);
        alert("âœ… ä¿®æ”¹æˆåŠŸ");
      } catch (err) {
        alert("âŒ ä¿®æ”¹å¤±æ•—ï¼š" + err.message);
      }
    }

    async function deleteEmployee() {
      const id = document.getElementById("d_id").value;
      if (!confirm(`ç¢ºå®šè¦åˆªé™¤å“¡å·¥ ID ${id} å—ï¼Ÿ`)) return;
      try {
        await axios.delete(`${api}/${id}`);
        alert("âœ… åˆªé™¤æˆåŠŸ");
      } catch (err) {
        alert("âŒ åˆªé™¤å¤±æ•—ï¼š" + err.message);
      }
    }
  </script>
</body>
</html>
